<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品資料測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="database.js"></script>
    <style>
        .test-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    
    <div class="max-w-6xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">商品資料測試頁面</h1>
            <p class="text-gray-600">測試資料庫商品資料初始化功能</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- 資料庫連接測試 -->
            <div class="test-card rounded-xl p-6 shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4">資料庫連接狀態</h2>
                <div id="dbStatus" class="text-lg mb-4">檢查中...</div>
                <button onclick="checkDatabaseStatus()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    重新檢查
                </button>
            </div>
            
            <!-- 商品初始化測試 -->
            <div class="test-card rounded-xl p-6 shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4">商品資料初始化</h2>
                <div id="initStatus" class="text-lg mb-4">準備就緒</div>
                <button onclick="initializeProducts()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                    初始化商品資料
                </button>
            </div>
            
            <!-- 商品列表顯示 -->
            <div class="test-card rounded-xl p-6 shadow-lg lg:col-span-2">
                <h2 class="text-xl font-bold text-gray-800 mb-4">商品列表</h2>
                <button onclick="loadProducts()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors mb-4">
                    載入商品資料
                </button>
                <div id="productsList" class="space-y-4">
                    <p class="text-gray-600">點擊上方按鈕載入商品資料</p>
                </div>
            </div>
            
            <!-- 資料欄位格式說明 -->
            <div class="test-card rounded-xl p-6 shadow-lg lg:col-span-2">
                <h2 class="text-xl font-bold text-gray-800 mb-4">商品資料欄位格式說明</h2>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <pre class="text-sm text-gray-700 overflow-x-auto">
{
  "name": "商品名稱",           // 必填，字串
  "barcode": "條碼",           // 必填，字串，唯一
  "category": "分類名稱",       // 必填，字串
  "price": 價格,               // 必填，數字
  "cost": 成本價,              // 選填，數字
  "stock": 庫存數量,           // 必填，數字
  "min_stock": 最低庫存,       // 選填，數字
  "description": "商品描述",   // 選填，字串
  "image_url": "圖片URL",      // 選填，字串
  "is_active": true,          // 選填，布林值，預設true
  "supplier_id": 供應商ID,     // 選填，數字
  "created_at": "建立時間",    // 自動產生
  "updated_at": "更新時間"     // 自動產生
}
                    </pre>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        // 檢查資料庫連接狀態
        async function checkDatabaseStatus() {
            const statusDiv = document.getElementById('dbStatus');
            statusDiv.textContent = '檢查中...';
            
            try {
                await DatabaseManager.initialize();
                const status = DatabaseManager.getStatus();
                
                if (status === 'connected') {
                    statusDiv.innerHTML = '<span class="text-green-600">✅ 資料庫連接成功</span>';
                } else if (status === 'connecting') {
                    statusDiv.innerHTML = '<span class="text-yellow-600">🔄 連接中...</span>';
                } else {
                    statusDiv.innerHTML = '<span class="text-red-600">❌ 資料庫連接失敗</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="text-red-600">❌ 檢查失敗: ' + error.message + '</span>';
            }
        }
        
        // 初始化商品資料
        async function initializeProducts() {
            const statusDiv = document.getElementById('initStatus');
            statusDiv.textContent = '初始化中...';
            
            try {
                const result = await BusinessAPI.initializeProducts();
                
                if (result) {
                    statusDiv.innerHTML = '<span class="text-green-600">✅ 成功初始化 ' + result.length + ' 樣商品</span>';
                } else {
                    statusDiv.innerHTML = '<span class="text-yellow-600">⚠️ 商品資料已存在或初始化失敗</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="text-red-600">❌ 初始化失敗: ' + error.message + '</span>';
            }
        }
        
        // 載入商品資料
        async function loadProducts() {
            const productsDiv = document.getElementById('productsList');
            productsDiv.innerHTML = '<p class="text-gray-600">載入中...</p>';
            
            try {
                const products = await BusinessAPI.getProducts();
                
                if (products && products.length > 0) {
                    let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
                    
                    products.forEach(product => {
                        html += `
                            <div class="bg-white p-4 rounded-lg shadow border">
                                <h3 class="font-bold text-lg mb-2">${product.name}</h3>
                                <div class="text-sm text-gray-600 space-y-1">
                                    <p><strong>條碼:</strong> ${product.barcode}</p>
                                    <p><strong>分類:</strong> ${product.category}</p>
                                    <p><strong>價格:</strong> NT$ ${product.price.toLocaleString()}</p>
                                    <p><strong>成本:</strong> NT$ ${product.cost ? product.cost.toLocaleString() : '未設定'}</p>
                                    <p><strong>庫存:</strong> ${product.stock} 件</p>
                                    <p><strong>最低庫存:</strong> ${product.min_stock || '未設定'}</p>
                                    <p><strong>狀態:</strong> <span class="${product.is_active ? 'text-green-600' : 'text-red-600'}">${product.is_active ? '啟用' : '停用'}</span></p>
                                </div>
                                ${product.description ? `<p class="text-sm text-gray-500 mt-2">${product.description}</p>` : ''}
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    productsDiv.innerHTML = html;
                } else {
                    productsDiv.innerHTML = '<p class="text-gray-600">沒有找到商品資料</p>';
                }
            } catch (error) {
                productsDiv.innerHTML = '<p class="text-red-600">載入失敗: ' + error.message + '</p>';
            }
        }
        
        // 頁面載入時自動檢查資料庫狀態
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkDatabaseStatus, 1000);
        });
    </script>
</body>
</html> 