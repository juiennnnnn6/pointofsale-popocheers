<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“è³‡æ–™æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="database.js"></script>
    <style>
        .test-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    
    <div class="max-w-6xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">å•†å“è³‡æ–™æ¸¬è©¦é é¢</h1>
            <p class="text-gray-600">æ¸¬è©¦è³‡æ–™åº«å•†å“è³‡æ–™åˆå§‹åŒ–åŠŸèƒ½</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- è³‡æ–™åº«é€£æ¥æ¸¬è©¦ -->
            <div class="test-card rounded-xl p-6 shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4">è³‡æ–™åº«é€£æ¥ç‹€æ…‹</h2>
                <div id="dbStatus" class="text-lg mb-4">æª¢æŸ¥ä¸­...</div>
                <button onclick="checkDatabaseStatus()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    é‡æ–°æª¢æŸ¥
                </button>
            </div>
            
            <!-- å•†å“åˆå§‹åŒ–æ¸¬è©¦ -->
            <div class="test-card rounded-xl p-6 shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4">å•†å“è³‡æ–™åˆå§‹åŒ–</h2>
                <div id="initStatus" class="text-lg mb-4">æº–å‚™å°±ç·’</div>
                <button onclick="initializeProducts()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                    åˆå§‹åŒ–å•†å“è³‡æ–™
                </button>
            </div>
            
            <!-- å•†å“åˆ—è¡¨é¡¯ç¤º -->
            <div class="test-card rounded-xl p-6 shadow-lg lg:col-span-2">
                <h2 class="text-xl font-bold text-gray-800 mb-4">å•†å“åˆ—è¡¨</h2>
                <button onclick="loadProducts()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors mb-4">
                    è¼‰å…¥å•†å“è³‡æ–™
                </button>
                <div id="productsList" class="space-y-4">
                    <p class="text-gray-600">é»æ“Šä¸Šæ–¹æŒ‰éˆ•è¼‰å…¥å•†å“è³‡æ–™</p>
                </div>
            </div>
            
            <!-- è³‡æ–™æ¬„ä½æ ¼å¼èªªæ˜ -->
            <div class="test-card rounded-xl p-6 shadow-lg lg:col-span-2">
                <h2 class="text-xl font-bold text-gray-800 mb-4">å•†å“è³‡æ–™æ¬„ä½æ ¼å¼èªªæ˜</h2>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <pre class="text-sm text-gray-700 overflow-x-auto">
{
  "name": "å•†å“åç¨±",           // å¿…å¡«ï¼Œå­—ä¸²
  "barcode": "æ¢ç¢¼",           // å¿…å¡«ï¼Œå­—ä¸²ï¼Œå”¯ä¸€
  "category": "åˆ†é¡åç¨±",       // å¿…å¡«ï¼Œå­—ä¸²
  "price": åƒ¹æ ¼,               // å¿…å¡«ï¼Œæ•¸å­—
  "cost": æˆæœ¬åƒ¹,              // é¸å¡«ï¼Œæ•¸å­—
  "stock": åº«å­˜æ•¸é‡,           // å¿…å¡«ï¼Œæ•¸å­—
  "min_stock": æœ€ä½åº«å­˜,       // é¸å¡«ï¼Œæ•¸å­—
  "description": "å•†å“æè¿°",   // é¸å¡«ï¼Œå­—ä¸²
  "image_url": "åœ–ç‰‡URL",      // é¸å¡«ï¼Œå­—ä¸²
  "is_active": true,          // é¸å¡«ï¼Œå¸ƒæ—å€¼ï¼Œé è¨­true
  "supplier_id": ä¾›æ‡‰å•†ID,     // é¸å¡«ï¼Œæ•¸å­—
  "created_at": "å»ºç«‹æ™‚é–“",    // è‡ªå‹•ç”¢ç”Ÿ
  "updated_at": "æ›´æ–°æ™‚é–“"     // è‡ªå‹•ç”¢ç”Ÿ
}
                    </pre>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        // æª¢æŸ¥è³‡æ–™åº«é€£æ¥ç‹€æ…‹
        async function checkDatabaseStatus() {
            const statusDiv = document.getElementById('dbStatus');
            statusDiv.textContent = 'æª¢æŸ¥ä¸­...';
            
            try {
                await DatabaseManager.initialize();
                const status = DatabaseManager.getStatus();
                
                if (status === 'connected') {
                    statusDiv.innerHTML = '<span class="text-green-600">âœ… è³‡æ–™åº«é€£æ¥æˆåŠŸ</span>';
                } else if (status === 'connecting') {
                    statusDiv.innerHTML = '<span class="text-yellow-600">ğŸ”„ é€£æ¥ä¸­...</span>';
                } else {
                    statusDiv.innerHTML = '<span class="text-red-600">âŒ è³‡æ–™åº«é€£æ¥å¤±æ•—</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="text-red-600">âŒ æª¢æŸ¥å¤±æ•—: ' + error.message + '</span>';
            }
        }
        
        // åˆå§‹åŒ–å•†å“è³‡æ–™
        async function initializeProducts() {
            const statusDiv = document.getElementById('initStatus');
            statusDiv.textContent = 'åˆå§‹åŒ–ä¸­...';
            
            try {
                const result = await BusinessAPI.initializeProducts();
                
                if (result) {
                    statusDiv.innerHTML = '<span class="text-green-600">âœ… æˆåŠŸåˆå§‹åŒ– ' + result.length + ' æ¨£å•†å“</span>';
                } else {
                    statusDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ å•†å“è³‡æ–™å·²å­˜åœ¨æˆ–åˆå§‹åŒ–å¤±æ•—</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="text-red-600">âŒ åˆå§‹åŒ–å¤±æ•—: ' + error.message + '</span>';
            }
        }
        
        // è¼‰å…¥å•†å“è³‡æ–™
        async function loadProducts() {
            const productsDiv = document.getElementById('productsList');
            productsDiv.innerHTML = '<p class="text-gray-600">è¼‰å…¥ä¸­...</p>';
            
            try {
                const products = await BusinessAPI.getProducts();
                
                if (products && products.length > 0) {
                    let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
                    
                    products.forEach(product => {
                        html += `
                            <div class="bg-white p-4 rounded-lg shadow border">
                                <h3 class="font-bold text-lg mb-2">${product.name}</h3>
                                <div class="text-sm text-gray-600 space-y-1">
                                    <p><strong>æ¢ç¢¼:</strong> ${product.barcode}</p>
                                    <p><strong>åˆ†é¡:</strong> ${product.category}</p>
                                    <p><strong>åƒ¹æ ¼:</strong> NT$ ${product.price.toLocaleString()}</p>
                                    <p><strong>æˆæœ¬:</strong> NT$ ${product.cost ? product.cost.toLocaleString() : 'æœªè¨­å®š'}</p>
                                    <p><strong>åº«å­˜:</strong> ${product.stock} ä»¶</p>
                                    <p><strong>æœ€ä½åº«å­˜:</strong> ${product.min_stock || 'æœªè¨­å®š'}</p>
                                    <p><strong>ç‹€æ…‹:</strong> <span class="${product.is_active ? 'text-green-600' : 'text-red-600'}">${product.is_active ? 'å•Ÿç”¨' : 'åœç”¨'}</span></p>
                                </div>
                                ${product.description ? `<p class="text-sm text-gray-500 mt-2">${product.description}</p>` : ''}
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    productsDiv.innerHTML = html;
                } else {
                    productsDiv.innerHTML = '<p class="text-gray-600">æ²’æœ‰æ‰¾åˆ°å•†å“è³‡æ–™</p>';
                }
            } catch (error) {
                productsDiv.innerHTML = '<p class="text-red-600">è¼‰å…¥å¤±æ•—: ' + error.message + '</p>';
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥è³‡æ–™åº«ç‹€æ…‹
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkDatabaseStatus, 1000);
        });
    </script>
</body>
</html> 