<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å ±è¡¨ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../ç´”æ‰‹å‹•æ¢ç¢¼è¼¸å…¥å™¨.js"></script>
    <script>
        // æª¢æŸ¥æƒæåŠŸèƒ½æ˜¯å¦è¼‰å…¥
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof window.quickScan !== 'function') {
                    console.log('æƒæåŠŸèƒ½æœªè¼‰å…¥ï¼Œæä¾›æ‰‹å‹•è¼¸å…¥æ›¿ä»£æ–¹æ¡ˆ');
                    window.quickScan = function(onSuccess, onError) {
                        const barcode = prompt('è«‹è¼¸å…¥æ¢ç¢¼è™Ÿç¢¼æŸ¥çœ‹éŠ·å”®å ±è¡¨\n\næ¸¬è©¦æ¢ç¢¼:\n1234567890123 - Nike Air Max 270 (éŠ·å”®:32ä»¶)\n2345678901234 - Apple Watch Series 9 (éŠ·å”®:18ä»¶)\n3456789012345 - Samsung Galaxy S24 (éŠ·å”®:15ä»¶)\n4567890123456 - JBL Tune 760NC (éŠ·å”®:0ä»¶)\n5678901234567 - Adidas é‹å‹•å¤–å¥— (éŠ·å”®:24ä»¶)\n6789012345678 - Ray-Ban å¤ªé™½çœ¼é¡ (éŠ·å”®:12ä»¶)');
                        if (barcode) {
                            onSuccess(barcode);
                        } else if (onError) {
                            onError(new Error('ç”¨æˆ¶å–æ¶ˆè¼¸å…¥'));
                        }
                    };
                    console.log('æ‰‹å‹•è¼¸å…¥åŠŸèƒ½å·²å°±ç·’');
                }
            }, 1000);
        });
    </script>
    <style>
        .apple-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .report-card {
            transition: all 0.3s ease;
        }
        .report-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-100 min-h-screen p-4">
    
    <!-- é ‚éƒ¨æ“ä½œå€ -->
    <div class="mb-6">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">å ±è¡¨ä¸­å¿ƒ</h1>
                <p class="text-gray-600">é€²éŠ·å­˜å ±è¡¨åˆ†æèˆ‡æ•¸æ“šçµ±è¨ˆ</p>
            </div>
            <div class="flex space-x-3">
                <div class="flex items-center space-x-2">
                    <input type="date" value="2024-12-01" 
                           class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <span class="text-sm text-gray-600">è‡³</span>
                    <input type="date" value="2024-12-24" 
                           class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <button onclick="goBackToMenu()" class="bg-purple-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-600 transition-colors">
                    <i class="fas fa-th-large mr-2"></i>å›é¸å–®
                </button>
                <button onclick="navigateToPage('members')" class="bg-emerald-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-emerald-600 transition-colors">
                    <i class="fas fa-users mr-2"></i>æœƒå“¡ç®¡ç†
                </button>
                <button class="bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-600 transition-colors">
                    <i class="fas fa-search mr-2"></i>æŸ¥è©¢
                </button>
                <button class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-600 transition-colors">
                    <i class="fas fa-download mr-2"></i>åŒ¯å‡ºPDF
                </button>
                <button id="quickProductReportBtn" class="bg-orange-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-orange-600 transition-colors">
                    <i class="fas fa-barcode mr-2"></i>å•†å“æŸ¥è©¢
                </button>
                <button onclick="quickCouponReport()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-yellow-600 transition-colors">
                    <i class="fas fa-ticket-alt mr-2"></i>å„ªæƒ åˆ¸çµ±è¨ˆ
                </button>
            </div>
        </div>
    </div>

    <!-- é—œéµç¸¾æ•ˆæŒ‡æ¨™ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        
        <!-- ç¸½éŠ·å”®é¡ -->
        <div class="apple-card rounded-xl p-6 report-card shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">æœ¬æœˆç¸½éŠ·å”®é¡</p>
                    <p class="text-2xl font-bold text-green-600">NT$485,360</p>
                    <p class="text-xs text-green-500">
                        <i class="fas fa-arrow-up mr-1"></i>+15.3% æ¯”ä¸Šæœˆ
                    </p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-chart-line text-green-600"></i>
                </div>
            </div>
        </div>

        <!-- ç¸½é€²è²¨é¡ -->
        <div class="apple-card rounded-xl p-6 report-card shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">æœ¬æœˆç¸½é€²è²¨é¡</p>
                    <p class="text-2xl font-bold text-blue-600">NT$285,420</p>
                    <p class="text-xs text-blue-500">
                        <i class="fas fa-arrow-up mr-1"></i>+8.7% æ¯”ä¸Šæœˆ
                    </p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-truck text-blue-600"></i>
                </div>
            </div>
        </div>

        <!-- æ¯›åˆ©ç‡ -->
        <div class="apple-card rounded-xl p-6 report-card shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">æœ¬æœˆæ¯›åˆ©ç‡</p>
                    <p class="text-2xl font-bold text-purple-600">41.2%</p>
                    <p class="text-xs text-purple-500">
                        <i class="fas fa-arrow-up mr-1"></i>+2.1% æ¯”ä¸Šæœˆ
                    </p>
                </div>
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-percentage text-purple-600"></i>
                </div>
            </div>
        </div>

        <!-- åº«å­˜é€±è½‰ç‡ -->
        <div class="apple-card rounded-xl p-6 report-card shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">åº«å­˜é€±è½‰ç‡</p>
                    <p class="text-2xl font-bold text-orange-600">3.8</p>
                    <p class="text-xs text-orange-500">
                        <i class="fas fa-arrow-up mr-1"></i>+0.3 æ¯”ä¸Šæœˆ
                    </p>
                </div>
                <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-sync text-orange-600"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- åœ–è¡¨åˆ†æå€åŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        
        <!-- é€²éŠ·å­˜è¶¨å‹¢åœ– -->
        <div class="apple-card rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">é€²éŠ·å­˜è¶¨å‹¢åˆ†æ</h3>
                <div class="flex items-center space-x-4 text-sm">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-1"></div>
                        <span>éŠ·å”®</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-1"></div>
                        <span>é€²è²¨</span>
                    </div>
                </div>
            </div>
            <div style="height: 120px; position: relative;">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <!-- å•†å“åˆ†é¡éŠ·å”®å æ¯” -->
        <div class="apple-card rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">å•†å“åˆ†é¡éŠ·å”®å æ¯”</h3>
                <span class="text-sm text-gray-600">æœ¬æœˆæ•¸æ“š</span>
            </div>
            <canvas id="categoryChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- è©³ç´°å ±è¡¨ -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        
        <!-- é€²éŠ·å­˜æ˜ç´°å ±è¡¨ -->
        <div class="apple-card rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">é€²éŠ·å­˜æ˜ç´°å ±è¡¨</h3>
                <button class="text-indigo-500 text-sm hover:underline">
                    <i class="fas fa-external-link-alt mr-1"></i>æŸ¥çœ‹è©³ç´°
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 text-gray-600">å•†å“åç¨±</th>
                            <th class="text-center py-3 text-gray-600">æœŸåˆåº«å­˜</th>
                            <th class="text-center py-3 text-gray-600">é€²è²¨</th>
                            <th class="text-center py-3 text-gray-600">éŠ·å”®</th>
                            <th class="text-center py-3 text-gray-600">æœŸæœ«åº«å­˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-100">
                            <td class="py-3">
                                <div class="flex items-center space-x-2">
                                    <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=32&h=32&fit=crop&crop=center" 
                                         class="w-8 h-8 rounded object-cover">
                                    <span>Nike Air Max 270</span>
                                </div>
                            </td>
                            <td class="text-center py-3">35</td>
                            <td class="text-center py-3 text-blue-600">+25</td>
                            <td class="text-center py-3 text-green-600">-12</td>
                            <td class="text-center py-3 font-semibold">48</td>
                        </tr>
                        <tr class="border-b border-gray-100">
                            <td class="py-3">
                                <div class="flex items-center space-x-2">
                                    <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=32&h=32&fit=crop&crop=center" 
                                         class="w-8 h-8 rounded object-cover">
                                    <span>Apple Watch Series 9</span>
                                </div>
                            </td>
                            <td class="text-center py-3">8</td>
                            <td class="text-center py-3 text-blue-600">+10</td>
                            <td class="text-center py-3 text-green-600">-15</td>
                            <td class="text-center py-3 font-semibold text-orange-600">3</td>
                        </tr>
                        <tr class="border-b border-gray-100">
                            <td class="py-3">
                                <div class="flex items-center space-x-2">
                                    <img src="https://images.unsplash.com/photo-1434056886845-dac89ffe9b56?w=32&h=32&fit=crop&crop=center" 
                                         class="w-8 h-8 rounded object-cover">
                                    <span>Samsung Galaxy S24</span>
                                </div>
                            </td>
                            <td class="text-center py-3">12</td>
                            <td class="text-center py-3 text-blue-600">+8</td>
                            <td class="text-center py-3 text-green-600">-5</td>
                            <td class="text-center py-3 font-semibold">15</td>
                        </tr>
                        <tr class="border-b border-gray-100">
                            <td class="py-3">
                                <div class="flex items-center space-x-2">
                                    <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=32&h=32&fit=crop&crop=center" 
                                         class="w-8 h-8 rounded object-cover">
                                    <span>JBL Tune 760NC</span>
                                </div>
                            </td>
                            <td class="text-center py-3">5</td>
                            <td class="text-center py-3 text-blue-600">+0</td>
                            <td class="text-center py-3 text-green-600">-5</td>
                            <td class="text-center py-3 font-semibold text-red-600">0</td>
                        </tr>
                        <tr>
                            <td class="py-3">
                                <div class="flex items-center space-x-2">
                                    <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=32&h=32&fit=crop&crop=center" 
                                         class="w-8 h-8 rounded object-cover">
                                    <span>Adidas é‹å‹•å¤–å¥—</span>
                                </div>
                            </td>
                            <td class="text-center py-3">15</td>
                            <td class="text-center py-3 text-blue-600">+12</td>
                            <td class="text-center py-3 text-green-600">-5</td>
                            <td class="text-center py-3 font-semibold">22</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ç‡Ÿæ¥­ç¸¾æ•ˆåˆ†æ -->
        <div class="apple-card rounded-xl p-6 shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ç‡Ÿæ¥­ç¸¾æ•ˆåˆ†æ</h3>
            
            <div class="space-y-6">
                
                <!-- ç†±éŠ·å•†å“TOP5 -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-3">ç†±éŠ·å•†å“ TOP 5</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="w-6 h-6 bg-yellow-500 text-white text-xs rounded-full flex items-center justify-center">1</span>
                                <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=32&h=32&fit=crop&crop=center" 
                                     class="w-8 h-8 rounded object-cover">
                                <span class="text-sm font-medium">Nike Air Max 270</span>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-semibold text-green-600">32 ä»¶</p>
                                <p class="text-xs text-gray-500">NT$102,400</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="w-6 h-6 bg-gray-400 text-white text-xs rounded-full flex items-center justify-center">2</span>
                                <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=32&h=32&fit=crop&crop=center" 
                                     class="w-8 h-8 rounded object-cover">
                                <span class="text-sm font-medium">Apple Watch</span>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-semibold text-green-600">18 ä»¶</p>
                                <p class="text-xs text-gray-500">NT$232,200</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="w-6 h-6 bg-orange-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                                <img src="https://images.unsplash.com/photo-1434056886845-dac89ffe9b56?w=32&h=32&fit=crop&crop=center" 
                                     class="w-8 h-8 rounded object-cover">
                                <span class="text-sm font-medium">Samsung Galaxy</span>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-semibold text-green-600">15 ä»¶</p>
                                <p class="text-xs text-gray-500">NT$433,500</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœˆåº¦æ¯”è¼ƒ -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-3">æœˆåº¦æ¯”è¼ƒ</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-600 mb-1">æœ¬æœˆéŠ·å”®</p>
                            <p class="text-lg font-bold text-blue-800">NT$485,360</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="text-sm text-gray-600 mb-1">ä¸ŠæœˆéŠ·å”®</p>
                            <p class="text-lg font-bold text-gray-800">NT$421,250</p>
                        </div>
                    </div>
                </div>

                <!-- åº«å­˜é è­¦ -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-3">åº«å­˜é è­¦æé†’</h4>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between p-2 bg-orange-50 rounded">
                            <span class="text-sm text-orange-800">Apple Watch Series 9</span>
                            <span class="text-xs text-orange-600">ä½åº«å­˜ (3ä»¶)</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-red-50 rounded">
                            <span class="text-sm text-red-800">JBL Tune 760NC</span>
                            <span class="text-xs text-red-600">ç¼ºè²¨ (0ä»¶)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ­æ´²å®¶å±…/ç“·å™¨åº—å•†å“éŠ·å”®æ•¸æ“šï¼ˆæ¨¡æ“¬ï¼‰
        const productSalesData = {
            'P001-01': {name: 'æ­å¼éª¨ç“·é¤ç›¤ - 20cm ç™½è‰²ç¶“å…¸æ¬¾', category: 'é¤å…·', price: 890, salesCount: 42, salesAmount: 37380, profit: 11214},
            'P001-02': {name: 'æ­å¼éª¨ç“·é¤ç›¤ - 20cm è—èŠ±åœ–æ¡ˆæ¬¾', category: 'é¤å…·', price: 950, salesCount: 28, salesAmount: 26600, profit: 7980},
            'P001-03': {name: 'æ­å¼éª¨ç“·é¤ç›¤ - 20cm é‡‘é‚Šå¥¢è¯æ¬¾', category: 'é¤å…·', price: 1280, salesCount: 15, salesAmount: 19200, profit: 5760},
            'P002-01': {name: 'æ–½è¯æ´›ä¸–å¥‡æ°´æ™¶é…’æ¯ - ç´…é…’æ¯ 300ml', category: 'é…’å…·', price: 2890, salesCount: 18, salesAmount: 52020, profit: 15606},
            'P002-02': {name: 'æ–½è¯æ´›ä¸–å¥‡æ°´æ™¶é…’æ¯ - é¦™æª³æ¯ 200ml', category: 'é…’å…·', price: 2590, salesCount: 22, salesAmount: 56980, profit: 17094},
            'P003-01': {name: 'åŒ—æ­é¢¨é™¶ç“·èŠ±ç“¶ - å°è™Ÿ 15cm ç°è‰²', category: 'æ“ºé£¾', price: 680, salesCount: 35, salesAmount: 23800, profit: 7140},
            'P003-02': {name: 'åŒ—æ­é¢¨é™¶ç“·èŠ±ç“¶ - ä¸­è™Ÿ 25cm ç™½è‰²', category: 'æ“ºé£¾', price: 980, salesCount: 20, salesAmount: 19600, profit: 5880},
            'P003-03': {name: 'åŒ—æ­é¢¨é™¶ç“·èŠ±ç“¶ - å¤§è™Ÿ 35cm é»‘è‰²', category: 'æ“ºé£¾', price: 1380, salesCount: 8, salesAmount: 11040, profit: 3312},
            'P004-01': {name: 'è‹±å¼éª¨ç“·èŒ¶æ¯çµ„ - ç¶“å…¸ç«ç‘°åœ–æ¡ˆ', category: 'èŒ¶å…·', price: 1590, salesCount: 0, salesAmount: 0, profit: 0},
            'P005-01': {name: 'æ³•å¼é¤å…·å¥—è£ - 4äººä»½åŸºç¤æ¬¾', category: 'é¤å…·', price: 3890, salesCount: 12, salesAmount: 46680, profit: 14004},
            'P005-02': {name: 'æ³•å¼é¤å…·å¥—è£ - 4äººä»½è±ªè¯æ¬¾', category: 'é¤å…·', price: 5890, salesCount: 6, salesAmount: 35340, profit: 10602},
            'P006-01': {name: 'å¾·åœ‹ä¸é½é‹¼å»šå…· - åŸºç¤3ä»¶çµ„', category: 'å»šå…·', price: 2200, salesCount: 14, salesAmount: 30800, profit: 9240}
        };

        // åˆå§‹åŒ–äº‹ä»¶ç›£è½
        document.addEventListener('DOMContentLoaded', function() {
            const quickReportBtn = document.getElementById('quickProductReportBtn');
            
            // å•†å“æŸ¥è©¢æŒ‰éˆ•
            quickReportBtn.addEventListener('click', function() {
                quickProductReport();
            });
        });

        // å¿«é€Ÿå•†å“å ±è¡¨æŸ¥è©¢
        function quickProductReport() {
            if (typeof window.quickScan === 'function') {
                window.quickScan(
                    // æƒææˆåŠŸå›èª¿
                    function(barcode) {
                        showProductReport(barcode);
                    },
                    // æƒæéŒ¯èª¤å›èª¿
                    function(error) {
                        alert('æƒæå¤±æ•—: ' + error.message);
                    }
                );
            } else {
                alert('æƒæåŠŸèƒ½å°šæœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
            }
        }

        // é¡¯ç¤ºå•†å“å ±è¡¨
        function showProductReport(barcode) {
            console.log('æŸ¥è©¢å•†å“å ±è¡¨:', barcode);
            
            const salesData = productSalesData[barcode];
            
            if (salesData) {
                const profitRate = salesData.salesAmount > 0 ? ((salesData.profit / salesData.salesAmount) * 100).toFixed(1) : 0;
                const avgSelling = salesData.salesCount > 0 ? Math.floor(salesData.salesAmount / salesData.salesCount) : 0;
                
                const reportMessage = 
                    `ğŸ“Š å•†å“éŠ·å”®å ±è¡¨\n\n` +
                    `å•†å“åç¨±ï¼š${salesData.name}\n` +
                    `å•†å“åˆ†é¡ï¼š${salesData.category}\n` +
                    `æ¢ç¢¼ï¼š${barcode}\n` +
                    `å–®åƒ¹ï¼šNT$${salesData.price.toLocaleString()}\n\n` +
                    `ğŸ“ˆ æœ¬æœŸéŠ·å”®æ•¸æ“šï¼š\n` +
                    `éŠ·å”®æ•¸é‡ï¼š${salesData.salesCount} ä»¶\n` +
                    `éŠ·å”®é‡‘é¡ï¼šNT$${salesData.salesAmount.toLocaleString()}\n` +
                    `éŠ·å”®æ¯›åˆ©ï¼šNT$${salesData.profit.toLocaleString()}\n` +
                    `æ¯›åˆ©ç‡ï¼š${profitRate}%\n` +
                    `å¹³å‡å”®åƒ¹ï¼šNT$${avgSelling.toLocaleString()}\n\n` +
                    `${salesData.salesCount > 0 ? 'âœ… æœ‰éŠ·å”®è¨˜éŒ„' : 'âŒ æœ¬æœŸç„¡éŠ·å”®'}`;
                
                alert(reportMessage);
                
                // å¯ä»¥é¸æ“‡é¡¯ç¤ºæ›´è©³ç´°çš„åœ–è¡¨
                if (salesData.salesCount > 0 && confirm('æ˜¯å¦è¦æŸ¥çœ‹è©²å•†å“çš„è©³ç´°éŠ·å”®è¶¨å‹¢ï¼Ÿ')) {
                    showDetailedChart(salesData);
                }
            } else {
                alert(`æ¢ç¢¼ ${barcode} æ‰¾ä¸åˆ°éŠ·å”®æ•¸æ“š`);
            }
        }

        // é¡¯ç¤ºè©³ç´°åœ–è¡¨ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        function showDetailedChart(salesData) {
            alert(
                `ğŸ“Š ${salesData.name} è©³ç´°åˆ†æ\n\n` +
                `è¿‘æœŸè¡¨ç¾ï¼š\n` +
                `â€¢ éŠ·å”®è¶¨å‹¢ï¼š${salesData.salesCount > 20 ? 'ğŸ“ˆ ç†±éŠ·' : salesData.salesCount > 10 ? 'ğŸ“Š æ­£å¸¸' : 'ğŸ“‰ æ»¯éŠ·'}\n` +
                `â€¢ åº«å­˜é€±è½‰ï¼š${salesData.salesCount > 15 ? 'ğŸ”„ è‰¯å¥½' : 'âš ï¸ éœ€é—œæ³¨'}\n` +
                `â€¢ åˆ©æ½¤è²¢ç»ï¼š${salesData.profit > 50000 ? 'ğŸ’° é«˜' : salesData.profit > 20000 ? 'ğŸ’µ ä¸­' : 'ğŸ’´ ä½'}\n\n` +
                `å»ºè­°ï¼š\n` +
                `${getSalesAdvice(salesData)}`
            );
        }

        // ç²å–éŠ·å”®å»ºè­°
        function getSalesAdvice(salesData) {
            if (salesData.salesCount === 0) {
                return 'â€¢ è€ƒæ…®ä¿ƒéŠ·æ´»å‹•æˆ–èª¿æ•´å®šåƒ¹ç­–ç•¥';
            } else if (salesData.salesCount > 20) {
                return 'â€¢ ç¶­æŒç¾æœ‰ç­–ç•¥ï¼Œè€ƒæ…®å¢åŠ åº«å­˜';
            } else if (salesData.salesCount > 10) {
                return 'â€¢ è¡¨ç¾æ­£å¸¸ï¼Œå¯è€ƒæ…®é©åº¦æ¨å»£';
            } else {
                return 'â€¢ åˆ†æéŠ·å”®é˜»ç¤™ï¼Œå„ªåŒ–æ¨å»£ç­–ç•¥';
            }
        }

        // å„ªæƒ åˆ¸çµ±è¨ˆæŸ¥è©¢
        function quickCouponReport() {
            // æ¨¡æ“¬å„ªæƒ åˆ¸ä½¿ç”¨æ•¸æ“šï¼ˆèˆ‡æ­æ´²å®¶å±…ç“·å™¨åº—ç›¸é—œï¼‰
            const couponUsageData = {
                'WELCOME2024': { 
                    name: 'æ–°æœƒå“¡æ­¡è¿ç¦®', 
                    usedCount: 156, 
                    totalDiscount: 23400, 
                    type: 'percentage', 
                    value: 15,
                    category: 'æ–°å®¢ç²å–',
                    validPeriod: '2024/01/01 - 2024/12/31'
                },
                'CNY2024': { 
                    name: 'æ˜¥ç¯€ç‰¹æƒ ', 
                    usedCount: 89, 
                    totalDiscount: 17800, 
                    type: 'fixed', 
                    value: 200,
                    category: 'ç¯€æ…¶æ´»å‹•',
                    validPeriod: '2024/02/01 - 2024/02/29'
                },
                'ANNIVERSARY50': { 
                    name: 'é€±å¹´æ…¶å¤§å„ªæƒ ', 
                    usedCount: 198, 
                    totalDiscount: 198000, 
                    type: 'percentage', 
                    value: 50,
                    category: 'åº—æ…¶æ´»å‹•',
                    validPeriod: '2024/03/01 - 2024/03/15'
                },
                'VIP2024': { 
                    name: 'VIPæœƒå“¡å°ˆäº«', 
                    usedCount: 245, 
                    totalDiscount: 49000, 
                    type: 'member_only', 
                    value: 20,
                    category: 'æœƒå“¡å°ˆå±¬',
                    validPeriod: '2024/01/01 - 2024/12/31'
                },
                'BUY3GET1': { 
                    name: 'è²·ä¸‰é€ä¸€æ´»å‹•', 
                    usedCount: 45, 
                    totalDiscount: 30600, 
                    type: 'buy_x_get_y', 
                    value: 0,
                    category: 'ä¿ƒéŠ·æ´»å‹•',
                    validPeriod: '2024/04/01 - 2024/04/30'
                }
            };

            const couponCode = prompt('ğŸ« å„ªæƒ åˆ¸çµ±è¨ˆæŸ¥è©¢\n\nè«‹è¼¸å…¥å„ªæƒ åˆ¸ä»£ç¢¼ï¼š\n\nğŸ“‹ å¯æŸ¥è©¢çš„å„ªæƒ åˆ¸ï¼š\nâ€¢ WELCOME2024 - æ–°æœƒå“¡æ­¡è¿ç¦®\nâ€¢ CNY2024 - æ˜¥ç¯€ç‰¹æƒ \nâ€¢ ANNIVERSARY50 - é€±å¹´æ…¶å¤§å„ªæƒ \nâ€¢ VIP2024 - VIPæœƒå“¡å°ˆäº«\nâ€¢ BUY3GET1 - è²·ä¸‰é€ä¸€æ´»å‹•\n\næˆ–è¼¸å…¥ "ALL" æŸ¥çœ‹æ•´é«”çµ±è¨ˆ');
            
            if (!couponCode) return;
            
            if (couponCode.toUpperCase() === 'ALL') {
                // é¡¯ç¤ºæ•´é«”å„ªæƒ åˆ¸çµ±è¨ˆ
                const totalUsed = Object.values(couponUsageData).reduce((sum, coupon) => sum + coupon.usedCount, 0);
                const totalDiscount = Object.values(couponUsageData).reduce((sum, coupon) => sum + coupon.totalDiscount, 0);
                const averageDiscount = totalUsed > 0 ? Math.round(totalDiscount / totalUsed) : 0;
                
                let report = `ğŸ« å„ªæƒ åˆ¸æ•´é«”çµ±è¨ˆå ±è¡¨\n\n`;
                report += `ğŸ“Š ç¸½é«”æ•¸æ“šï¼š\n`;
                report += `â€¢ ç¸½ä½¿ç”¨æ¬¡æ•¸ï¼š${totalUsed.toLocaleString()} æ¬¡\n`;
                report += `â€¢ ç¸½æŠ˜æ‰£é‡‘é¡ï¼šNT$${totalDiscount.toLocaleString()}\n`;
                report += `â€¢ å¹³å‡æŠ˜æ‰£ï¼šNT$${averageDiscount.toLocaleString()}/æ¬¡\n\n`;
                
                report += `ğŸ“ˆ å„å„ªæƒ åˆ¸è¡¨ç¾ï¼š\n`;
                Object.entries(couponUsageData).forEach(([code, coupon]) => {
                    const usage = ((coupon.usedCount / totalUsed) * 100).toFixed(1);
                    report += `â€¢ ${coupon.name}ï¼š${coupon.usedCount}æ¬¡ (${usage}%)\n`;
                });
                
                alert(report);
                return;
            }
            
            if (couponUsageData[couponCode.toUpperCase()]) {
                const coupon = couponUsageData[couponCode.toUpperCase()];
                const averageDiscount = coupon.usedCount > 0 ? Math.round(coupon.totalDiscount / coupon.usedCount) : 0;
                const conversionRate = Math.min((coupon.usedCount / 1000) * 100, 100); // å‡è¨­ç™¼è¡Œ1000å¼µ
                
                let typeText;
                switch (coupon.type) {
                    case 'percentage':
                        typeText = `${coupon.value}% ç™¾åˆ†æ¯”æŠ˜æ‰£`;
                        break;
                    case 'fixed':
                        typeText = `NT$${coupon.value} å›ºå®šé‡‘é¡æŠ˜æ‰£`;
                        break;
                    case 'member_only':
                        typeText = `æœƒå“¡å°ˆå±¬ ${coupon.value}% æŠ˜æ‰£`;
                        break;
                    case 'buy_x_get_y':
                        typeText = 'è²·3é€1ç‰¹æ®Šå„ªæƒ ';
                        break;
                    default:
                        typeText = 'ç‰¹æ®Šå„ªæƒ ';
                }
                
                const effectiveness = coupon.usedCount > 150 ? 'ğŸ”¥ éå¸¸æœ‰æ•ˆ' : 
                                   coupon.usedCount > 100 ? 'âœ… æ•ˆæœè‰¯å¥½' : 
                                   coupon.usedCount > 50 ? 'ğŸ“Š æ•ˆæœä¸€èˆ¬' : 'âš ï¸ éœ€è¦æ”¹é€²';
                
                alert(`ğŸ« å„ªæƒ åˆ¸è©³ç´°çµ±è¨ˆå ±è¡¨\n\n` +
                    `ğŸ“‹ åŸºæœ¬è³‡è¨Šï¼š\n` +
                    `â€¢ å„ªæƒ åˆ¸åç¨±ï¼š${coupon.name}\n` +
                    `â€¢ ä»£ç¢¼ï¼š${couponCode.toUpperCase()}\n` +
                    `â€¢ é¡å‹ï¼š${typeText}\n` +
                    `â€¢ åˆ†é¡ï¼š${coupon.category}\n` +
                    `â€¢ æœ‰æ•ˆæœŸï¼š${coupon.validPeriod}\n\n` +
                    `ğŸ“ˆ ä½¿ç”¨æ•¸æ“šï¼š\n` +
                    `â€¢ ä½¿ç”¨æ¬¡æ•¸ï¼š${coupon.usedCount.toLocaleString()} æ¬¡\n` +
                    `â€¢ ç¸½æŠ˜æ‰£é‡‘é¡ï¼šNT$${coupon.totalDiscount.toLocaleString()}\n` +
                    `â€¢ å¹³å‡æŠ˜æ‰£ï¼šNT$${averageDiscount.toLocaleString()}/æ¬¡\n` +
                    `â€¢ è½‰æ›ç‡ï¼š${conversionRate.toFixed(1)}%\n\n` +
                    `ğŸ¯ æ•ˆæœè©•ä¼°ï¼š${effectiveness}\n\n` +
                    `ğŸ’¡ å„ªåŒ–å»ºè­°ï¼š\n${getCouponAdvice(coupon)}`);
            } else {
                alert('âŒ æ‰¾ä¸åˆ°è©²å„ªæƒ åˆ¸çš„ä½¿ç”¨è³‡æ–™\n\nè«‹æª¢æŸ¥ä»£ç¢¼æ˜¯å¦æ­£ç¢ºï¼Œæˆ–è¼¸å…¥ "ALL" æŸ¥çœ‹æ‰€æœ‰å„ªæƒ åˆ¸çµ±è¨ˆ');
            }
        }

        // ç²å–å„ªæƒ åˆ¸å„ªåŒ–å»ºè­°
        function getCouponAdvice(coupon) {
            if (coupon.usedCount > 200) {
                return 'â€¢ æ­¤å„ªæƒ åˆ¸è¡¨ç¾å„ªç•°ï¼Œå¯è€ƒæ…®å»¶é•·ä½¿ç”¨æœŸé™\nâ€¢ å»ºè­°è£½ä½œé¡ä¼¼çš„å„ªæƒ åˆ¸æ“´å¤§å½±éŸ¿';
            } else if (coupon.usedCount > 100) {
                return 'â€¢ è¡¨ç¾è‰¯å¥½ï¼Œå¯è€ƒæ…®åœ¨é¡ä¼¼æ™‚æœŸé‡æ–°æ¨å‡º\nâ€¢ é©åº¦èª¿æ•´æŠ˜æ‰£åŠ›åº¦ä»¥æå‡å¸å¼•åŠ›';
            } else if (coupon.usedCount > 50) {
                return 'â€¢ æ•ˆæœä¸€èˆ¬ï¼Œå»ºè­°æª¢è¦–æ¨å»£ç®¡é“\nâ€¢ è€ƒæ…®å¢åŠ ä½¿ç”¨èª˜å› æˆ–ç°¡åŒ–ä½¿ç”¨æµç¨‹';
            } else {
                return 'â€¢ éœ€è¦æ”¹é€²æ¨å»£ç­–ç•¥\nâ€¢ æª¢è¦–ç›®æ¨™å®¢ç¾¤æ˜¯å¦ç²¾æº–\nâ€¢ è€ƒæ…®èª¿æ•´æŠ˜æ‰£é–€æª»æˆ–åŠ›åº¦';
            }
        }

        // é€²éŠ·å­˜è¶¨å‹¢åœ–
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['12/1', '12/5', '12/10', '12/15', '12/20', '12/24'],
                datasets: [{
                    label: 'éŠ·å”®é¡',
                    data: [15000, 28000, 35000, 42000, 38000, 48000],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'é€²è²¨é¡',
                    data: [12000, 18000, 25000, 30000, 22000, 28000],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // å•†å“åˆ†é¡åœ“é¤…åœ–
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: ['é›»å­ç”¢å“', 'é‹å‹•ç”¨å“', 'æœé£¾é‹å¸½', 'æ™‚å°šé…ä»¶', 'å…¶ä»–'],
                datasets: [{
                    data: [45, 25, 15, 10, 5],
                    backgroundColor: [
                        '#3b82f6',
                        '#10b981',
                        '#f59e0b',
                        '#8b5cf6',
                        '#6b7280'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // çµ±ä¸€å°èˆªå‡½æ•¸
        function navigateToPage(page) {
            try {
                // å˜—è©¦èˆ‡çˆ¶é é¢é€šä¿¡åˆ‡æ›iframe
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({
                        type: 'navigate',
                        page: page
                    }, '*');
                } else {
                    // å¦‚æœä¸åœ¨iframeä¸­ï¼Œç›´æ¥è·³è½‰
                    window.location.href = `${page}.html`;
                }
            } catch (error) {
                // å‚™ç”¨æ–¹æ¡ˆï¼šåœ¨æ–°åˆ†é ä¸­é–‹å•Ÿ
                window.open(`${page}.html`, '_blank');
            }
        }

        // å›åˆ°ä¸»é é¢
        function goBackToMenu() {
            window.location.href = '../index.html';
        }
    </script>
</body>
</html> 